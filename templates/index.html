<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORA - Your AI Companion</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }

        .header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }

        .personality-display {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .user-greeting {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }

        .personality-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        .personality-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            margin: 2px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .personality-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .personality-btn.active {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
        }

        .sun-container {
            position: relative;
            width: 300px;
            height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sun-container:hover {
            transform: scale(1.05);
        }

        .sun-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffd700, #ffaa00, #ff6b00);
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.8),
                0 0 120px rgba(255, 215, 0, 0.4),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .sun-rays {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
        }

        .ray {
            position: absolute;
            background: linear-gradient(to right, rgba(255, 215, 0, 0.8), transparent);
            transform-origin: left center;
        }

        .ray:nth-child(1) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(0deg); }
        .ray:nth-child(2) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(45deg); }
        .ray:nth-child(3) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(90deg); }
        .ray:nth-child(4) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(135deg); }
        .ray:nth-child(5) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(180deg); }
        .ray:nth-child(6) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(225deg); }
        .ray:nth-child(7) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(270deg); }
        .ray:nth-child(8) { width: 80px; height: 4px; top: 50%; left: 50%; transform: translate(90px, -2px) rotate(315deg); }

        .status-text {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .listening {
            background: radial-gradient(circle at 30% 30%, #4fc3f7, #29b6f6, #0288d1);
            box-shadow: 
                0 0 60px rgba(79, 195, 247, 0.8),
                0 0 120px rgba(79, 195, 247, 0.4),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
        }

        .processing {
            background: radial-gradient(circle at 30% 30%, #ffb74d, #ff9800, #f57c00);
            box-shadow: 
                0 0 60px rgba(255, 183, 77, 0.8),
                0 0 120px rgba(255, 183, 77, 0.4),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
        }

        .speaking {
            background: radial-gradient(circle at 30% 30%, #81c784, #66bb6a, #4caf50);
            box-shadow: 
                0 0 60px rgba(129, 199, 132, 0.8),
                0 0 120px rgba(129, 199, 132, 0.4),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
        }

        .error {
            background: radial-gradient(circle at 30% 30%, #e57373, #f44336, #d32f2f);
            box-shadow: 
                0 0 60px rgba(229, 115, 115, 0.8),
                0 0 120px rgba(229, 115, 115, 0.4),
                inset 0 0 60px rgba(255, 255, 255, 0.2);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .transcript {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            max-width: 80%;
            text-align: center;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .transcript.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .sun-container {
                width: 250px;
                height: 250px;
            }
            
            .sun-core {
                width: 150px;
                height: 150px;
                font-size: 20px;
            }
            
            .sun-rays {
                width: 250px;
                height: 250px;
            }
            
            .personality-switcher {
                position: fixed;
                bottom: 20px;
                right: 20px;
                top: auto;
            }
            
            .header {
                top: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="personality-display" id="personalityDisplay">The Empathetic Friend</div>
        <div class="user-greeting" id="userGreeting">Hello, User</div>
    </div>

    <div class="personality-switcher">
        <button class="personality-btn" onclick="changePersonality('practical')">Practical Coach</button>
        <button class="personality-btn active" onclick="changePersonality('empathetic')">Empathetic Friend</button>
        <button class="personality-btn" onclick="changePersonality('wise')">Wise Mentor</button>
    </div>

    <div class="sun-container" id="sunContainer" onclick="toggleListening()">
        <div class="sun-rays">
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
            <div class="ray"></div>
        </div>
        <div class="sun-core" id="sunCore">
            ORA
        </div>
    </div>

    <div class="status-text" id="statusText">Click to start talking</div>
    <div class="transcript" id="transcript"></div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();
        
        // State variables
        let isListening = false;
        let isConnected = false;
        let currentPersonality = 'empathetic';
        let userName = localStorage.getItem('ora_user_name') || 'User';
        let userPersonality = localStorage.getItem('ora_personality') || 'empathetic';
        
        // DOM elements
        const sunCore = document.getElementById('sunCore');
        const statusText = document.getElementById('statusText');
        const transcript = document.getElementById('transcript');
        const personalityDisplay = document.getElementById('personalityDisplay');
        const userGreeting = document.getElementById('userGreeting');
        
        // Initialize on page load
        window.addEventListener('load', function() {
            // Set user info from localStorage
            currentPersonality = userPersonality;
            updatePersonalityDisplay();
            updateUserGreeting();
            
            // Connect to server
            connectToServer();
        });
        
        // Socket event handlers
        socket.on('connect', function() {
            console.log('Connected to server');
            isConnected = true;
            updateStatus('Connected! Click to start talking');
        });
        
        socket.on('disconnect', function() {
            console.log('Disconnected from server');
            isConnected = false;
            updateStatus('Disconnected. Refresh to reconnect.');
            sunCore.className = 'sun-core error';
        });
        
        socket.on('conversation_started', function(data) {
            console.log('Conversation started:', data);
            updateStatus('Ready to talk! Click to speak');
            sunCore.className = 'sun-core';
        });
        
        socket.on('audio_response', function(data) {
            console.log('Received audio response');
            playAudioResponse(data.audio);
        });
        
        socket.on('transcript', function(data) {
            console.log('Transcript:', data.text);
            showTranscript(data.text);
        });
        
        socket.on('emotions', function(data) {
            console.log('Emotions detected:', data.emotions);
        });
        
        socket.on('personality_changed', function(data) {
            console.log('Personality changed:', data);
            updateStatus(data.status);
            updatePersonalityDisplay();
        });
        
        socket.on('error', function(data) {
            console.error('Socket error:', data.message);
            updateStatus('Error: ' + data.message);
            sunCore.className = 'sun-core error';
            isListening = false;
        });
        
        // Main functions
        function connectToServer() {
            if (!isConnected) {
                updateStatus('Connecting...');
                return;
            }
            
            // Start conversation with personality
            socket.emit('start_conversation', {
                personality: currentPersonality,
                user_name: userName
            });
        }
        
        function toggleListening() {
            if (!isConnected) {
                connectToServer();
                return;
            }
            
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }
        
        function startListening() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                updateStatus('Microphone not supported');
                return;
            }
            
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    isListening = true;
                    updateStatus('Listening... Click to stop');
                    sunCore.className = 'sun-core listening pulse';
                    
                    // Start recording audio
                    startAudioRecording(stream);
                })
                .catch(function(error) {
                    console.error('Microphone access denied:', error);
                    updateStatus('Microphone access denied');
                    sunCore.className = 'sun-core error';
                });
        }
        
        function stopListening() {
            isListening = false;
            updateStatus('Processing...');
            sunCore.className = 'sun-core processing pulse';
            
            // Stop recording and send audio
            stopAudioRecording();
        }
        
        function startAudioRecording(stream) {
            // Create MediaRecorder
            const mediaRecorder = new MediaRecorder(stream);
            const audioChunks = [];
            
            mediaRecorder.ondataavailable = function(event) {
                audioChunks.push(event.data);
            };
            
            mediaRecorder.onstop = function() {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                const reader = new FileReader();
                
                reader.onload = function() {
                    const base64Audio = reader.result.split(',')[1];
                    socket.emit('send_audio', { audio: base64Audio });
                };
                
                reader.readAsDataURL(audioBlob);
                
                // Stop all tracks
                stream.getTracks().forEach(track => track.stop());
            };
            
            // Store recorder reference
            window.currentRecorder = mediaRecorder;
            
            // Start recording
            mediaRecorder.start();
            
            // Auto-stop after 10 seconds
            setTimeout(function() {
                if (isListening && mediaRecorder.state === 'recording') {
                    stopListening();
                }
            }, 10000);
        }
        
        function stopAudioRecording() {
            if (window.currentRecorder && window.currentRecorder.state === 'recording') {
                window.currentRecorder.stop();
            }
        }
        
        function playAudioResponse(base64Audio) {
            try {
                updateStatus('ORA is speaking...');
                sunCore.className = 'sun-core speaking pulse';
                
                const audio = new Audio('data:audio/wav;base64,' + base64Audio);
                
                audio.onended = function() {
                    updateStatus('Click to continue talking');
                    sunCore.className = 'sun-core';
                };
                
                audio.onerror = function() {
                    console.error('Audio playback error');
                    updateStatus('Audio playback error');
                    sunCore.className = 'sun-core error';
                };
                
                audio.play();
                
            } catch (error) {
                console.error('Error playing audio:', error);
                updateStatus('Error playing audio');
                sunCore.className = 'sun-core error';
            }
        }
        
        function changePersonality(personality) {
            currentPersonality = personality;
            localStorage.setItem('ora_personality', personality);
            
            // Update UI
            updatePersonalityDisplay();
            updatePersonalityButtons();
            
            // Emit personality change
            socket.emit('change_personality', { personality: personality });
        }
        
        function updatePersonalityDisplay() {
            const personalities = {
                'practical': 'The Practical Coach',
                'empathetic': 'The Empathetic Friend',
                'wise': 'The Wise Mentor'
            };
            
            personalityDisplay.textContent = personalities[currentPersonality];
        }
        
        function updatePersonalityButtons() {
            const buttons = document.querySelectorAll('.personality-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(currentPersonality)) {
                    btn.classList.add('active');
                }
            });
        }
        
        function updateUserGreeting() {
            userGreeting.textContent = `Hello, ${userName}`;
        }
        
        function updateStatus(message) {
            statusText.textContent = message;
        }
        
        function showTranscript(text) {
            transcript.textContent = text;
            transcript.classList.add('show');
            
            setTimeout(function() {
                transcript.classList.remove('show');
            }, 3000);
        }
        
        // Initialize personality buttons
        updatePersonalityButtons();
    </script>
</body>
</html>




